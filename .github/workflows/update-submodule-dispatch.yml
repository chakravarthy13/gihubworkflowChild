name: Update submodule when notified

# Purpose: Listen for `repository_dispatch` events (type: submodule-updated)
# sent from the Main repository. When received, this workflow updates the
# local `gihubworkflowMain` submodule to the remote's latest commit, commits
# the gitlink change in the Child repo, and pushes it back to the Child repo's
# `main` branch.
#
# Adjust these values if your submodule path or branch differs.

on:
  repository_dispatch:
    types: [ submodule-updated ]

jobs:
  update:
    # Runner that executes the update steps
    runs-on: ubuntu-latest
    steps:
      # 1) Checkout the repository and initialize submodules so they are
      #    available locally for the update operation.
      - name: Checkout repository (with submodules)
        uses: actions/checkout@v4
        with:
          # We only have a single-level submodule; use non-recursive init.
          submodules: true
          fetch-depth: 0            # fetch full history for commits/refs

      # 2) Update step: configure git identity, pull submodule remote HEAD,
      #    stage the updated gitlink, and push if there are changes.
      - name: Update submodule
        run: |
          # Set a clear committer identity for automated commits.
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

          # Update the named submodule to the latest commit on its tracked ref.
          # Replace `gihubworkflowMain` with your submodule path if different.
          git submodule update --init --remote gihubworkflowMain

          # Stage the submodule gitlink change (the parent repo records the
          # submodule commit SHA in the git index; adding the folder updates it)
          git add gihubworkflowMain

          # If there are no staged changes, exit early and report nothing to do.
          if git diff --cached --quiet; then
            echo "No update needed"
            exit 0
          fi

          # Commit the updated submodule pointer and push back to the Child repo.
          git commit -m "Update submodule to latest"
          git push origin HEAD:main
